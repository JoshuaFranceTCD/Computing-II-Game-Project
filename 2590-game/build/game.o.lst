   1              	# 0 "./src/game.s"
   2              	# 1 "/Users/ciaraquinn/SynologyDrive/github/Computing-II-Game-Project/2590-game//"
   1              	...
   0              	
   0              	
   1              	# PASTE LINK TO TEAM VIDEO BELOW
   2              	#
   3              	#
   4              	
   5              	  .syntax unified
   6              	  .cpu cortex-m4
   7              	  .fpu softvfp
   8              	  .thumb
   9              	  
  10              	  .global Main
  11              	  .global  SysTick_Handler
  12              	  .global EXTI0_IRQHandler
  13              	
  14              	  @ Definitions are in definitions.s to keep this file "clean"
  15              	  .include "./src/definitions.s"
   1              	  .equ    GPIOE_BASE, 0x48001000
   2              	  .equ    GPIOE_MODER, (GPIOE_BASE + 0x00)
   3              	  .equ    GPIOE_OTYPER, (GPIOE_BASE + 0x04)
   4              	  .equ    GPIOE_OSPEEDR, (GPIOE_BASE + 0x08)
   5              	  .equ    GPIOE_PUPDR, (GPIOE_BASE + 0x0C)
   6              	  .equ    GPIOE_IDR, (GPIOE_BASE + 0x10)
   7              	  .equ    GPIOE_ODR, (GPIOE_BASE + 0x14)
   8              	  .equ    GPIOE_BSRR, (GPIOE_BASE + 0x18)
   9              	  .equ    GPIOE_LCKR, (GPIOE_BASE + 0x1C)
  10              	  .equ    GPIOE_AFRL, (GPIOE_BASE + 0x20)
  11              	  .equ    GPIOE_AFRH, (GPIOE_BASE + 0x24)
  12              	
  13              	  .equ    RCC_BASE, 0x40021000
  14              	  .equ    RCC_AHBENR, (RCC_BASE + 0x14)
  15              	  .equ    RCC_AHBENR_GPIOEEN_BIT, 21
  16              	
  17              	  .equ    SYSTICK_BASE, 0xE000E010
  18              	  .equ    SYSTICK_CSR, (SYSTICK_BASE + 0x00)
  19              	  .equ    SYSTICK_LOAD, (SYSTICK_BASE + 0x04)
  20              	  .equ    SYSTICK_VAL, (SYSTICK_BASE + 0x08)
  21              	
  22              	  .equ    SYSCFG_BASE, (0x40010000)
  23              	  .equ    SYSCFG_EXTIICR1, (SYSCFG_BASE + 0x08)
  24              	
  25              	  .equ    NVIC_ISER, 0xE000E100
  26              	
  27              	  .equ    EXTI_BASE, 0x40010400
  28              	  .equ    EXTI_IMR, (EXTI_BASE + 0x00)
  29              	  .equ    EXTI_RTSR, (EXTI_BASE + 0x08)
  30              	  .equ    EXTI_FTSR, (EXTI_BASE + 0x0C)
  31              	  .equ    EXTI_PR, (EXTI_BASE + 0x14)
  32              	
  33              	  .equ    LD3_PIN, 9
  34              	  .equ    LD4_PIN, 8
  35              	  .equ    LD5_PIN, 10
  36              	  .equ    LD6_PIN, 15
  37              	  .equ    LD7_PIN, 11
  38              	  .equ    LD8_PIN, 14
  39              	  .equ    LD9_PIN, 12
  40              	  .equ    LD10_PIN, 13
  41              	  
  42              	  .equ    SCB_BASE, 0xE000ED00
  43              	  .equ    SCB_ICSR, (SCB_BASE + 0x04)
  44              	  .equ    SCB_ICSR_PENDSTCLR, (1<<25)
  16              	
  17              	  
  18              	
  19              	  .section .text
  20              	  
  21              	  .equ    FLASH_OFF_TIMER  , 1500      // length of time the flash remains of(static)
  22              	  .equ    FLASH_ON_TIMER   , 500       // length of time the light flashes on (changes depending on
  23              	Main:
  24 0000 30B5     	  PUSH  {R4-R5,LR}
  25              	
  26              	
  27              	  /*************************************   SET UP  ************************************************
  28              	  @
  29              	  @ Prepare GPIO Port E Pin 9 for output (LED LD3)
  30              	  @ We'll blink LED LD3 (the orange LED)
  31              	  @
  32              	  @ Enable GPIO port E by enabling its clock
  33 0002 494C     	  LDR     R4, =RCC_AHBENR
  34 0004 2568     	  LDR     R5, [R4]
  35 0006 45F40015 	  ORR     R5, R5, #(0b1 << (RCC_AHBENR_GPIOEEN_BIT))
  36 000a 2560     	  STR     R5, [R4]
  37              	  @ Initialise the first countdown
  38 000c 474C     	  LDR     R4, =blink_countdown
  39 000e 40F2DC55 	  LDR     R5, =FLASH_OFF_TIMER
  40 0012 2560     	  STR     R5, [R4]  
  41              	
  42              	
  43              	
  44              	
  45              	  @ Configure SysTick Timer to generate an interrupt every 1ms
  46 0014 464C     	  LDR     R4, =SCB_ICSR               @ Clear any pre-existing interrupts
  47 0016 4FF00075 	  LDR     R5, =SCB_ICSR_PENDSTCLR     @
  48 001a 2560     	  STR     R5, [R4]                    @
  49 001c 454C     	  LDR     R4, =SYSTICK_CSR            @ Stop SysTick timer
  50 001e 4FF00005 	  LDR     R5, =0                      @   by writing 0 to CSR
  51 0022 2560     	  STR     R5, [R4]                    @   CSR is the Control and Status Register
  52 0024 444C     	  LDR     R4, =SYSTICK_LOAD           @ Set SysTick LOAD for 1ms delay
  53 0026 41F63F75 	  LDR     R5, =7999                   @ Assuming 8MHz clock
  54 002a 2560     	  STR     R5, [R4]                    @ 
  55 002c 434C     	  LDR     R4, =SYSTICK_VAL            @   Reset SysTick internal counter to 0
  56 002e 4FF00105 	  LDR     R5, =0x1                    @     by writing any value
  57 0032 2560     	  STR     R5, [R4]
  58 0034 3F4C     	  LDR     R4, =SYSTICK_CSR            @   Start SysTick timer by setting CSR to 0x7
  59 0036 4FF00705 	  LDR     R5, =0x7                    @     set CLKSOURCE (bit 2) to system clock (1)
  60 003a 2560     	  STR     R5, [R4]                    @     set TICKINT (bit 1) to 1 to enable interrupts
  61              	                                      @     set ENABLE (bit 0) to 1
  62              	
  63              	
  64              	
  65              	  @ Prepare external interrupt Line 0 (USER pushbutton)
  66              	  @ 
  67              	  @ Configure USER pushbutton (GPIO Port A Pin 0 on STM32F3 Discovery
  68              	  @   kit) to use the EXTI0 external interrupt signal
  69              	  @ Determined by bits 3..0 of the External Interrrupt Control
  70              	  @   Register (EXTIICR)
  71 003c 404C     	  LDR     R4, =SYSCFG_EXTIICR1
  72 003e 2568     	  LDR     R5, [R4]
  73 0040 25F00F05 	  BIC     R5, R5, #0b1111
  74 0044 2560     	  STR     R5, [R4]
  75              	  @ Enable (unmask) interrupts on external interrupt Line0
  76 0046 3F4C     	  LDR     R4, =EXTI_IMR
  77 0048 2568     	  LDR     R5, [R4]
  78 004a 45F00105 	  ORR     R5, R5, #1
  79 004e 2560     	  STR     R5, [R4]
  80              	  @ Set falling edge detection on Line0
  81 0050 3D4C     	  LDR     R4, =EXTI_FTSR
  82 0052 2568     	  LDR     R5, [R4]
  83 0054 45F00105 	  ORR     R5, R5, #1
  84 0058 2560     	  STR     R5, [R4]
  85              	  @ Enable NVIC interrupt #6 (external interrupt Line0)
  86 005a 3C4C     	  LDR     R4, =NVIC_ISER
  87 005c 4FF04005 	  MOV     R5, #(1<<6)
  88 0060 2560     	  STR     R5, [R4]
  89              	
  90              	
  91              	
  92              	/****************************************** Main Program ******************************************
  93              	
  94 0062 4FF00006 	  MOV    R6,#0                @ create points variable
  95              	
  96              	.equ     currentPin, LD3_PIN  @ set currentPin to LD3_PIN
  97 0066 00F024F8 	  BL      enableLED           @ enable the currentPin
  98              	
  99              	// loop continously until player reacts correctly
 100              	level1:
 101 006a 394C     	  LDR   R4, =reacted 
 102 006c 2568     	  LDR   R5, [R4]
 103 006e 012D     	  CMP   R5, #1
 104 0070 00D0     	  BEQ   endLevel1
 105 0072 FAE7     	  B     level1
 106              	endLevel1:
 107 0074 06F10106 	  ADD   R6,R6,#1                @ level 1 completed, points++;
 108              	   
 109              	  .equ     FLASH_ON_TIMER, 200  @ FLASH_ON_TIMER = 200 (flash on timer becomes smaller each time)
 110              	
 111              	  .equ     currentPin, LD4_PIN  @ set currentPin to LD4_PIN
 112 0078 00F01BF8 	   BL      enableLED            @ enable the currentPin
 113              	
 114 007c 4FF00005 	   MOV   R5,#0
 115 0080 2568     	   LDR   R5, [R4]               @ reacted = 0  
 116              	
 117              	level2:
 118 0082 334C     	  LDR   R4, = reacted 
 119 0084 2568     	  LDR   R5, [R4]
 120 0086 012D     	  CMP   R5, #1
 121 0088 00D0     	  BEQ   endLevel2
 122 008a FAE7     	  B     level2
 123              	endLevel2:
 124 008c 06F10106 	  ADD   R6,R6,#1                @ level 2 completed, points++;
 125              	
 126              	// level 3, 4 etc
 127              	
 128              	// C. Quinn, created ending sequence, 13:00, 06/04/2024
 129 0090 012E     	  CMP       R6,#1                   @ if score > 1, flash first LED
 130 0092 0DD9     	  BLS       End_Main
 131              	  .equ      currentPin, LD3_PIN     @ set currentPin to LD3_PIN
 132 0094 00F00DF8 	  BL        enableLED               @ enable the currentPin
 133 0098 022E     	  CMP       R6,#2                   @ if score > 2, flash second LED
 134 009a 09D9     	  BLS       End_Main
 135              	  .equ      currentPin, LD4_PIN     @ set currentPin to LD3_PIN
 136 009c 00F009F8 	  BL        enableLED               @ enable the currentPin
 137 00a0 032E     	  CMP       R6,#3                   @ if score > 3, flash third LED
 138 00a2 05D9     	  BLS       End_Main
 139              	  .equ      currentPin, LD5_PIN     @ set currentPin to LD3_PIN
 140 00a4 00F005F8 	  BL        enableLED               @ enable the currentPin
 141 00a8 042E     	  CMP       R6,#4                   @ if score > 4, flash third LED
 142 00aa 01D9     	  BLS       End_Main
 143              	  .equ      currentPin, LD6_PIN     @ set currentPin to LD3_PIN
 144 00ac 00F001F8 	  BL        enableLED               @ enable the currentPin
 145              	
 146              	
 147              	End_Main:
 148 00b0 30BD     	  POP   {R4-R5,PC}
 149              	
 150              	
 151              	/*******************************Subroutines & Interrupts **********************/
 152              	
 153              	
 154              	
 155              	
 156              	
 157              	
 158              	
 159              	
 160              	
 161              	  @ enableLed subroutine:
 162              	
 163              	  @ enables the desired LED for output
 164              	  @ parameters: 
 165              	  @   currentPin
 166              	
 167              	
 168              	enableLED:
 169              	  @  Configure LD3 for output
 170              	  @   by setting bits 27:26 of GPIOE_MODER to 01 (GPIO Port E Mode Register)
 171              	  @   (by BIClearing then ORRing)
 172 00b2 30B5     	  PUSH    {R4-R5,LR}
 173 00b4 274C     	  LDR     R4, =GPIOE_MODER
 174 00b6 2568     	  LDR     R5, [R4]                    @ Read ...
 175 00b8 25F04045 	  BIC     R5, #(0b11<<(currentPin*2))    @ Modify ...
 176 00bc 45F08045 	  ORR     R5, #(0b01<<(currentPin*2))    @ write 01 to bits 
 177 00c0 2560     	  STR     R5, [R4]                    @ Write 
 178 00c2 30BD     	  POP    {R4-R5,PC}
 179              	
 180              	
 181              	
 182              	
 183              	
 184              	
 185              	
 186              	
 187              	
 188              	
 189              	@
 190              	@ SysTick interrupt handler (blink currentLED)
 191              	@
 193              	SysTick_Handler:
 194 00c4 30B5     	  PUSH  {R4, R5, LR}
 195 00c6 194C     	  LDR   R4, =blink_countdown        @ if (countdown != 0) {
 196 00c8 2568     	  LDR   R5, [R4]                    @
 197 00ca 002D     	  CMP   R5, #0                      @
 198 00cc 03D0     	  BEQ   .LelseFire                  @
 199 00ce A5F10105 	  SUB   R5, R5, #1                  @   countdown = countdown - 1;
 200 00d2 2560     	  STR   R5, [R4]                    @
 201 00d4 14E0     	  B     .LendIfDelay                @ }
 202              	.LelseFire:                         @ else {
 203 00d6 1E4E     	  LDR     R6, = reacted             @
 204 00d8 3768     	  LDR     R7,  [R6]
 205 00da 012F     	  CMP     R7,#1                     @   )
 206 00dc 04D0     	  BEQ     .LskipInvert              @   if(reacted) Invert LD3L
 207 00de 1E4C     	  LDR     R4, =GPIOE_ODR            @   {
 208 00e0 2568     	  LDR     R5, [R4]                  @   ledStatus = on/off
 209 00e2 85F40045 	  EOR     R5, #(0b1<<(currentPin))  @   GPIOE_ODR = GPIOE_ODR ^ (1<<currentPin);
 210 00e6 2560     	  STR     R5, [R4]                  @   ledStatus = !ledStatus
 211              	.LskipInvert:                       @   }
 212 00e8 B5F5004F 	  CMP     R5, #(0b1<<(currentPin))  @   if(ledStatus = off)
 213 00ec 04D0     	  BEQ     .LflashOn                 @   {
 214 00ee 0F4C     	  LDR     R4, =blink_countdown      @     
 215 00f0 40F2DC55 	  LDR     R5, = FLASH_OFF_TIMER     @
 216 00f4 2560     	  STR     R5, [R4]                  @     countdown = FLASH_OFF_TIMER;
 217 00f6 03E0     	  B       .LendIfDelay              @   }
 218              	.LflashOn:
 219 00f8 0C4C     	  LDR     R4, =blink_countdown      @   else{
 220 00fa 4FF0C805 	  LDR     R5, = FLASH_ON_TIMER
 221 00fe 2560     	  STR     R5, [R4]                  @   countdown = FLASH_ON_TIMER;
 222              	                                    @
 223              	.LendIfDelay:                       @     }
 224 0100 0B4C     	  LDR     R4, =SCB_ICSR             @ Clear (acknowledge) the interrupt
 225 0102 4FF00075 	  LDR     R5, =SCB_ICSR_PENDSTCLR   @
 226 0106 2560     	  STR     R5, [R4]                  @
 227              	  @ Return from interrupt handler
 228 0108 30BD     	  POP  {R4, R5, PC}
 229              	
 230              	
 231              	@
 232              	@ External interrupt line 0 interrupt handler(Push Button Handler)
 233              	@   (Check if player pressed the button on time)
 234              	@
 236              	EXTI0_IRQHandler:
 237 010a 30B5     	  PUSH  {R4,R5,LR}
 238 010c 124C     	  LDR   R4, =GPIOE_ODR
 239 010e 2568     	  LDR   R5, [R4]
 240 0110 B5F5004F 	  CMP   R5, #(0b1<<(currentPin))
 241 0114 03D1     	  BNE   .LledNotOn
 242 0116 0E4C     	  LDR   R4, = reacted
 243 0118 4FF00105 	  MOV   R5, #1
 244 011c 2560     	  STR   R5, [R4]
 245              	  .LledNotOn:
 246 011e 0F4C     	  LDR   R4, =EXTI_PR                @ Clear (acknowledge) the interrupt
 247 0120 4FF00105 	  MOV   R5, #(1<<0)                 @
 248 0124 2560     	  STR   R5, [R4]                    @
 249              	  @ Return from interrupt handler
 250 0126 30BD     	  POP  {R4,R5,PC}
 251              	
 252              	
 253              	
 254              	// memoryAddresses
 255              	  .section .data
 256              	blink_countdown:
 257 0000 00000000 	  .space  4
 258              	reacted:
 259 0004 00000000 	  .space 4
 260              	
 261              	
 262              	
 263              	  .end...
DEFINED SYMBOLS
        ./src/game.s:23     .text:00000000 Main
        ./src/game.s:193    .text:000000c4 SysTick_Handler
        ./src/game.s:236    .text:0000010a EXTI0_IRQHandler
 ./src/definitions.s:1      *ABS*:48001000 GPIOE_BASE
 ./src/definitions.s:2      *ABS*:48001000 GPIOE_MODER
 ./src/definitions.s:3      *ABS*:48001004 GPIOE_OTYPER
 ./src/definitions.s:4      *ABS*:48001008 GPIOE_OSPEEDR
 ./src/definitions.s:5      *ABS*:4800100c GPIOE_PUPDR
 ./src/definitions.s:6      *ABS*:48001010 GPIOE_IDR
 ./src/definitions.s:7      *ABS*:48001014 GPIOE_ODR
 ./src/definitions.s:8      *ABS*:48001018 GPIOE_BSRR
 ./src/definitions.s:9      *ABS*:4800101c GPIOE_LCKR
 ./src/definitions.s:10     *ABS*:48001020 GPIOE_AFRL
 ./src/definitions.s:11     *ABS*:48001024 GPIOE_AFRH
 ./src/definitions.s:13     *ABS*:40021000 RCC_BASE
 ./src/definitions.s:14     *ABS*:40021014 RCC_AHBENR
 ./src/definitions.s:15     *ABS*:00000015 RCC_AHBENR_GPIOEEN_BIT
 ./src/definitions.s:17     *ABS*:e000e010 SYSTICK_BASE
 ./src/definitions.s:18     *ABS*:e000e010 SYSTICK_CSR
 ./src/definitions.s:19     *ABS*:e000e014 SYSTICK_LOAD
 ./src/definitions.s:20     *ABS*:e000e018 SYSTICK_VAL
 ./src/definitions.s:22     *ABS*:40010000 SYSCFG_BASE
 ./src/definitions.s:23     *ABS*:40010008 SYSCFG_EXTIICR1
 ./src/definitions.s:25     *ABS*:e000e100 NVIC_ISER
 ./src/definitions.s:27     *ABS*:40010400 EXTI_BASE
 ./src/definitions.s:28     *ABS*:40010400 EXTI_IMR
 ./src/definitions.s:29     *ABS*:40010408 EXTI_RTSR
 ./src/definitions.s:30     *ABS*:4001040c EXTI_FTSR
 ./src/definitions.s:31     *ABS*:40010414 EXTI_PR
 ./src/definitions.s:33     *ABS*:00000009 LD3_PIN
 ./src/definitions.s:34     *ABS*:00000008 LD4_PIN
 ./src/definitions.s:35     *ABS*:0000000a LD5_PIN
 ./src/definitions.s:36     *ABS*:0000000f LD6_PIN
 ./src/definitions.s:37     *ABS*:0000000b LD7_PIN
 ./src/definitions.s:38     *ABS*:0000000e LD8_PIN
 ./src/definitions.s:39     *ABS*:0000000c LD9_PIN
 ./src/definitions.s:40     *ABS*:0000000d LD10_PIN
 ./src/definitions.s:42     *ABS*:e000ed00 SCB_BASE
 ./src/definitions.s:43     *ABS*:e000ed04 SCB_ICSR
 ./src/definitions.s:44     *ABS*:02000000 SCB_ICSR_PENDSTCLR
        ./src/game.s:21     *ABS*:000005dc FLASH_OFF_TIMER
        ./src/game.s:22     *ABS*:000000c8 FLASH_ON_TIMER
        ./src/game.s:24     .text:00000000 $t
        ./src/game.s:256    .data:00000000 blink_countdown
        ./src/game.s:96     *ABS*:0000000f currentPin
        ./src/game.s:168    .text:000000b2 enableLED
        ./src/game.s:100    .text:0000006a level1
        ./src/game.s:258    .data:00000004 reacted
        ./src/game.s:106    .text:00000074 endLevel1
        ./src/game.s:117    .text:00000082 level2
        ./src/game.s:123    .text:0000008c endLevel2
        ./src/game.s:147    .text:000000b0 End_Main
        ./src/game.s:257    .data:00000000 $d
        ./src/game.s:263    .text:00000128 $d

NO UNDEFINED SYMBOLS
